name: Push zazlib to Common Lib
on:
  push:
    paths:
      - 'zazlib/**' # zazlibフォルダの変更時のみ発火
    branches: [ main ]

jobs:
  push-to-common:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          path: project
      - uses: actions/checkout@v4
        with:
          repository: zaz4416/ZazLib # 共通リポジトリ
          token: ${{ secrets.MY_PAT }}
          path: common
      - name: Sync back to Common
        run: |
          # プロジェクトの zazlib を 共通リポジトリのルートへ同期
          rsync -av --delete --exclude=".git/" project/zazlib/ common/
      - uses: peter-evans/create-pull-request@v5
        with:
          path: common
          token: ${{ secrets.MY_PAT }}
          branch: from-${{ github.event.repository.name }}
          title: "🚀 Update from ${{ github.event.repository.name }}"
          body: "プロジェクト側での修正を共通リポジトリに反映します。"
